<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="index.css">

    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- MARK: Allows testing React right in the browser (no modules installation required)! -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- MARK: Allows writing JSX right in the browser! -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
</head>

<body>
    <div id="root"></div>
</body>

<script>
    const Range = (n) => ({
        toArray: () => Array(n).fill().map((_, i) => i),
        map: f => Array(n).fill().map((_, i) => f(i))
    })

    const addDays = (date, days) => {
        var result = new Date(date)
        result.setDate(result.getDate() + days)
        return result
    }

    const compareDates = (date1, date2) =>
        date1.getDate() == date2.getDate() && date1.getHours() == date2.getHours()
</script>

<script type="text/babel">
    const CalendarContext = React.createContext()

    const DatesView = ({ date }) => {
        const currentDate = new Date('03/29/2021')

        const weekday = ['S', 'M', 'T', 'W', 'T', 'F', 'S']

        const dates = Range(7).map(i => addDays(date, i))

        return (
            <div className="dates">
                <div className="cell" />
                {
                    dates.map(date =>
                        <div className="cell date" key={date}>
                            <div className="dateLabel">{weekday[date.getDay()]}</div>
                            <div className={date.getDate() == currentDate.getDate() ? "dateNumber dateActive" : "dateNumber"}>{date.getDate()}</div>
                        </div>
                    )
                }
            </div>
        )
    }

    const DatesSelector = ({ startDate, month }) => {
        return (
            <div className="datesSelector">
                <DatesView date={startDate} />

                <div className="weekSelector">
                    <div className="cell" />
                    <button className="button cell">
                        <span className="material-symbols-outlined">arrow_back_ios</span>
                    </button>
                    <div className="monthTitle">{month}</div>
                    <button className="button cell">
                        <span className="material-symbols-outlined">arrow_forward_ios</span>
                    </button>
                </div>
            </div>
        )
    }

    const HourView = ({ hour, events }) => {
        const { startDate, selectedEvent, setSelectedEvent } = React.useContext(CalendarContext)

        const checkDate = date =>
            events.some(event => compareDates(event.date, date))

        const dates = Range(7).map(i => {
            const date = addDays(startDate, i)
            date.setHours(hour)
            return date
        })
        const label = hour < 10 ? `0${hour}:00` : `${hour}:00`

        const handleClick = date => {
            const event = events.find(event => compareDates(event.date, date))

            if (event !== undefined)
                setSelectedEvent(event)
            else setSelectedEvent(undefined)
        }

        return (
            <div className="hourRow">
                <div className="label cell">{label}</div>
                <div className="eventsRow">
                    {dates.map(date =>
                        <div
                            key={date}
                            className={selectedEvent !== undefined && compareDates(date, selectedEvent.date) ? "hourCell event active" : checkDate(date) ? "hourCell event" : "hourCell"}
                            onClick={() => handleClick(date)}
                        />
                    )}
                </div>
            </div>
        )
    }

    const DayView = ({ events }) => {
        const hours = Range(24).toArray()
        return (
            <div className="events">
                {hours.map(hour =>
                    <HourView hour={hour} key={hour} events={events.filter(event => event.date.getHours() == hour)} />
                )}
            </div>
        )
    }

    const CalendarView = () => {
        const startDate = new Date('03/25/2019')
        const month = 'March 2019'

        const [events, setEvents] = React.useState([
            { date: new Date('03/25/2019 12:00') },
            { date: new Date('03/26/2019 12:00') },
            { date: new Date('03/27/2019 12:00') },
            { date: new Date('03/28/2019 12:00') },
            { date: new Date('03/29/2019 12:00') },
            { date: new Date('03/30/2019 12:00') },
            { date: new Date('03/31/2019 12:00') },
            { date: new Date('03/29/2019 8:00') },
            { date: new Date('03/28/2019 15:00') },
            { date: new Date('03/29/2019 17:00') },
            { date: new Date('03/26/2019 20:00') },
        ])
        const [selectedEvent, setSelectedEvent] = React.useState(undefined)

        const handleAdd = () => {
            const input = prompt("Enter event time:\nYYYY-MM-DD HH:mm:ss"),
                date = new Date(input)

            if (!isNaN(date))
                setEvents(events => [...events, { date: date }])
        }
        const handleDelete = () => {
            if (selectedEvent !== undefined) {
                setEvents(events =>
                    events.filter(event =>
                        false == compareDates(event.date, selectedEvent.date))
                )
                setSelectedEvent(undefined)
            }
        }

        return (
            <CalendarContext.Provider value={{ events, selectedEvent, setSelectedEvent, startDate }}>
                <div className="calendar">
                    <header className="title">
                        <h1>Interview Calendar</h1>
                        <button onClick={handleAdd}>
                            <span className="material-symbols-outlined">add</span>
                        </button>
                    </header >
                    <main className="main">
                        <DatesSelector startDate={startDate} month={month} />
                        <div className="scrollview">
                            <DayView events={events} />
                        </div>
                    </main >
                    <footer className="footer">
                        <button>Today</button>
                        <div style={{ flex: 1 }} />
                        {selectedEvent !== undefined && <button onClick={handleDelete}>Delete</button>}
                    </footer>
                </div >
            </CalendarContext.Provider>
        )
    }

    ReactDOM.createRoot(document.getElementById('root')).render(
        <CalendarView />
    )
</script>

</html>