<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />

    <!-- MARK: Allows testing React right in the browser (no modules installation required)! -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-is/umd/react-is.development.js"></script>
    <script crossorigin src="http://unpkg.com/styled-components@5/dist/styled-components.min.js"></script>

    <!-- MARK: Allows writing JSX right in the browser! -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>

<body>
    <div id="root"></div>
</body>


<!-- Utilities file -->
<script>
    const Range = (n) => ({
        toArray: () => Array(n).fill().map((_, i) => i),
        map: f => Array(n).fill().map((_, i) => f(i))
    })

    const addDays = (date, days) => {
        var result = new Date(date)
        result.setDate(result.getDate() + days)
        return result
    }

    const compareDates = (date1, date2) =>
        date1.getDate() == date2.getDate() && date1.getHours() == date2.getHours()
</script>


<!-- StyledComponents file -->
<script>
    const { ThemeProvider, createGlobalStyle, css } = styled

    // MARK: Global
    const GlobalStyles = createGlobalStyle`
    body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    #root {
        display: flex;
        justify-content: center;
    }
`

    const Calendar = styled.div`
    width: 740px;
    height: 100vh;
    max-height: -webkit-fill-available;
    display: flex;
    flex-direction: column;
`

    const Flex = styled.div`
    display: flex;
`

    const Button = styled.button`
    cursor: pointer;
    background: none;
    border: none;
    color: ${({ theme }) => theme.colors.primary};
    display: block;
    margin: auto;
    font-size: large;
`

    const GridCell = styled.div`
    width: calc(100% / ${({ columns }) => columns});
`


    // MARK: Header
    const Header = styled.header`
    display: flex;
    padding: 0.5rem;
    border-bottom: 1px solid ${({ theme }) => theme.colors.border};

    h1 {
        font-weight: 200;
        flex: 1;
    }
`


    // MARK: Main
    const Main = styled.main`
    overflow-y: hidden;
    flex: 1;
    display: flex;
    flex-direction: column;
`

    // Dates selector
    const DatesSelectorStyled = styled.div`
    background: ${({ theme }) => theme.colors.bg};
    padding-block: 0.5rem;
    border-bottom: 1px solid ${({ theme }) => theme.colors.border};
`

    const DateCell = styled(GridCell)`
    display: flex;
    flex-direction: column;
    align-items: center;
`

    const DateLabel = styled.div`
    font-size: small;
`

    const DateNumber = styled.div`
    padding: 0.5rem;
    clip-path: circle();

    ${({ isActive, theme }) => isActive && css`
        background-color: ${theme.colors.primary};
        color: white;
    `}
`

    const MonthTitle = styled.div`
    width: calc(100% / 8 * 5);
    text-align: center;
`

    // MARK: Events view
    const ScrollViewStyled = styled.div`
    height: 100%;
    overflow-y: auto;
`

    const EventsStyled = styled.div`
    display: flex;
    flex-direction: column;
    gap: 2px;
    background-color: ${({ theme }) => theme.colors.border};
    margin-block: 0.7rem;
    border-top: 2px solid ${({ theme }) => theme.colors.border};
`

    const TimeCell = styled(GridCell)`
    margin-top: -0.7rem;
    box-sizing: border-box;
    padding-inline: 0.5rem;
    text-align: end;
    background-color: white;
    color: ${({ theme }) => theme.colors.gray};
    z-index: 1;
`

    const EventsRow = styled.div`
    display: flex;
    gap: 2px;
    flex: 1;
`

    const HourCell = styled(GridCell)`
    border: 2px solid white;
    background-color: white;
    height: 2rem;
    box-sizing: border-box;

    ${({ isEvent }) => isEvent && css`
        cursor: pointer;
        background-color: ${({ theme }) => theme.colors.secondary};
    `}

    ${({ isSelected, theme }) => isSelected && css`
        background-color: ${theme.colors.secondaryPrimary};
    `}
`


    // MARK: Footer
    const Footer = styled.div`
    background-color: ${({ theme }) => theme.colors.bg}; 
    text-align: center;
    padding: 1em;
    display: flex;
    border-top: 1px solid ${({ theme }) => theme.colors.border};
`
</script>


<!-- Components file -->
<script type="text/babel">
    const CalendarContext = React.createContext()

    const theme = {
        colors: {
            primary: 'rgb(235, 71, 61)',
            secondary: 'rgb(235, 236, 253)',
            secondaryPrimary: 'rgb(179, 184, 250)',
            bg: 'rgb(246, 246, 246)',
            border: 'rgb(235, 235, 235)',
            gray: 'rgb(192, 192, 192)'
        }
    }

    const DatesView = ({ date }) => {
        const currentDate = new Date('03/29/2021')

        const weekday = ['S', 'M', 'T', 'W', 'T', 'F', 'S']

        const dates = Range(7).map(i => addDays(date, i))

        return (
            <Flex>
                <GridCell columns={8} />
                {
                    dates.map(date =>
                        <DateCell columns={8} key={date}>
                            <DateLabel>{weekday[date.getDay()]}</DateLabel>
                            <DateNumber isActive={date.getDate() === currentDate.getDate()}>
                                {date.getDate()}
                            </DateNumber>
                        </DateCell>
                    )
                }
            </Flex>
        )
    }

    const DatesSelector = ({ startDate, month }) => {
        return (
            <DatesSelectorStyled>
                <DatesView date={startDate} />

                <Flex>
                    <GridCell columns={8} />
                    <GridCell columns={8}>
                        <Button>
                            <span className="material-symbols-outlined">arrow_back_ios</span>
                        </Button>
                    </GridCell>
                    <MonthTitle>{month}</MonthTitle>
                    <GridCell columns={8}>
                        <Button>
                            <span className="material-symbols-outlined">arrow_forward_ios</span>
                        </Button>
                    </GridCell>
                </Flex>
            </DatesSelectorStyled>
        )
    }

    const HourView = ({ hour, events }) => {
        const { startDate, selectedEvent, setSelectedEvent } = React.useContext(CalendarContext)

        const checkDate = date =>
            events.some(event => compareDates(event.date, date))

        const dates = Range(7).map(i => {
            const date = addDays(startDate, i)
            date.setHours(hour)
            return date
        })
        const label = hour < 10 ? `0${hour}:00` : `${hour}:00`

        const handleClick = date => {
            const event = events.find(event => compareDates(event.date, date))

            if (event !== undefined)
                setSelectedEvent(event)
            else setSelectedEvent(undefined)
        }

        return (
            <Flex>
                <TimeCell columns={8}>{label}</TimeCell>
                <EventsRow>
                    {dates.map(date =>
                        <HourCell
                            key={date}
                            columns={7}
                            isEvent={checkDate(date)}
                            isSelected={selectedEvent !== undefined && compareDates(date, selectedEvent.date)}
                            onClick={() => handleClick(date)}
                        />
                    )}
                </EventsRow>
            </Flex>
        )
    }

    const DayView = ({ events }) => {
        const hours = Range(24).toArray()
        return (
            <EventsStyled>
                {hours.map(hour =>
                    <HourView
                        hour={hour}
                        events={events.filter(event => event.date.getHours() === hour)}
                        key={hour}
                    />
                )}
            </EventsStyled>
        )
    }

    const CalendarView = () => {
        const startDate = new Date('03/25/2019')
        const month = 'March 2019'

        const [events, setEvents] = React.useState([
            { date: new Date('03/25/2019 12:00') },
            { date: new Date('03/26/2019 12:00') },
            { date: new Date('03/27/2019 12:00') },
            { date: new Date('03/28/2019 12:00') },
            { date: new Date('03/29/2019 12:00') },
            { date: new Date('03/30/2019 12:00') },
            { date: new Date('03/31/2019 12:00') },
            { date: new Date('03/29/2019 8:00') },
            { date: new Date('03/28/2019 15:00') },
            { date: new Date('03/29/2019 17:00') },
            { date: new Date('03/26/2019 20:00') },
        ])
        const [selectedEvent, setSelectedEvent] = React.useState(undefined)

        const handleAdd = () => {
            const input = prompt("Enter event time:\nYYYY-MM-DD HH:mm:ss"),
                date = new Date(input)

            if (!isNaN(date))
                setEvents(events => [...events, { date: date }])
        }
        const handleDelete = () => {
            if (selectedEvent !== undefined) {
                setEvents(events =>
                    events.filter(event =>
                        false === compareDates(event.date, selectedEvent.date))
                )
                setSelectedEvent(undefined)
            }
        }

        return (
            <CalendarContext.Provider value={{ events, selectedEvent, setSelectedEvent, startDate }}>
                <ThemeProvider theme={theme}>
                    <GlobalStyles />
                    <Calendar>
                        <Header>
                            <h1>Interview Calendar</h1>
                            <Button onClick={handleAdd}>
                                <span className="material-symbols-outlined">add</span>
                            </Button>
                        </Header >
                        <Main>
                            <DatesSelector startDate={startDate} month={month} />
                            <ScrollViewStyled>
                                <DayView events={events} />
                            </ScrollViewStyled>
                        </Main>
                        <Footer>
                            <Button>Today</Button>
                            <div style={{ flex: 1 }} />
                            {selectedEvent !== undefined && <Button onClick={handleDelete}>Delete</Button>}
                        </Footer>
                    </Calendar>
                </ThemeProvider>
            </CalendarContext.Provider>
        )
    }

    ReactDOM.createRoot(document.getElementById('root')).render(
        <CalendarView />
    )
</script>

</html>